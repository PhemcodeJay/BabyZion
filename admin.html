<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - BABYZION MARKET</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="favicon.png">
  <meta property="og:title" content="BABYZION MARKET">
  <meta property="og:description" content="Adorable, safe & stylish baby clothes, toys, and essentials.">
</head>
<body class="gradient">

  <header>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="products.html">Shop All</a></li>
        <li><a href="admin.html" class="active">Admin</a></li>
      </ul>
    </nav>
    <div class="logo-container">
      <img src="logo.png" alt="BABYZION MARKET" class="header-logo">
    </div>
    <h1>Admin Dashboard</h1>
    <p class="tagline">Manage your marketplace</p>
  </header>

  <main id="admin-content" style="display:none; max-width:1200px; margin:40px auto; padding:20px;" class="grid">
    <div class="card">
      <h3>Seller Product Uploads</h3>
      <p>Products submitted by sellers for approval</p>
      <div id="uploads-list"></div>
    </div>

    <div class="card">
      <h3>CJ Dropshipping Sync</h3>
      <p>Sync products from CJ Dropshipping API</p>
      <input type="text" id="sync-keyword" placeholder="Search keyword (e.g., baby)" value="baby" style="width:100%; padding:12px; margin:10px 0; border-radius:25px; border:2px solid #ffd6e0;">
      <input type="number" id="sync-count" placeholder="Number of products" value="20" min="1" max="100" style="width:100%; padding:12px; margin:10px 0; border-radius:25px; border:2px solid #ffd6e0;">
      <button class="button" onclick="syncCJProducts()" style="width:100%;">Sync Products</button>
      <div id="sync-status" style="margin-top:15px;"></div>
    </div>

    <div class="card">
      <h3>All Products</h3>
      <div id="products-list"></div>
    </div>
  </main>

  <div id="login-form" style="max-width:400px; margin:40px auto;">
    <div class="card">
      <h3>Admin Login</h3>
      <input type="password" id="admin-pass" placeholder="Enter password" style="width:100%; padding:12px; margin:10px 0; border-radius:25px; border:2px solid #ffd6e0;">
      <button class="button" onclick="login()" style="width:100%;">Login</button>
    </div>
  </div>

  <footer>
    <p>© 2025 BABYZION MARKET • Made with love for little ones</p>
  </footer>

  <script>
    const ADMIN_PASS = "babyzion2025";

    function login() {
      if (document.getElementById('admin-pass').value === ADMIN_PASS) {
        document.getElementById('login-form').style.display = 'none';
        document.getElementById('admin-content').style.display = 'grid';
        loadAdminData();
      } else {
        alert('Wrong password!');
      }
    }

    async function loadAdminData() {
      await loadUploads();
      await loadProducts();
    }

    async function loadUploads() {
      const uploadsList = document.getElementById('uploads-list');
      uploadsList.innerHTML = '<p>Loading seller uploads...</p>';
      
      try {
        const response = await fetch('/api/uploads');
        if (response.ok) {
          const uploads = await response.json();
          uploadsList.innerHTML = '';
          
          if (uploads.length === 0) {
            uploadsList.innerHTML = '<p style="color:#999;">No seller uploads yet.</p>';
            return;
          }

          uploads.forEach(upload => {
            const div = document.createElement('div');
            div.style.cssText = 'border:1px solid #ffd6e0; padding:15px; margin:10px 0; border-radius:15px;';
            div.innerHTML = `
              <h4>${upload.product_name}</h4>
              <p>${upload.description}</p>
              <p><strong>Price:</strong> $${upload.price.toFixed(2)} | <strong>Category:</strong> ${upload.category}</p>
              <p><strong>Seller:</strong> ${upload.seller_name} (${upload.seller_email})</p>
              <p><strong>Status:</strong> <span style="color:${upload.status === 'pending' ? 'orange' : 'green'}">${upload.status}</span></p>
            `;
            uploadsList.appendChild(div);
          });
        } else {
          uploadsList.innerHTML = '<p style="color:#ff6b9d;">Failed to load uploads.</p>';
        }
      } catch (error) {
        console.error('Error loading uploads:', error);
        uploadsList.innerHTML = '<p style="color:#ff6b9d;">Error loading uploads.</p>';
      }
    }

    async function loadProducts() {
      const productsList = document.getElementById('products-list');
      productsList.innerHTML = '<p>Loading products...</p>';
      
      try {
        const response = await fetch('/api/products');
        if (response.ok) {
          const products = await response.json();
          productsList.innerHTML = '';
          
          if (products.length === 0) {
            productsList.innerHTML = '<p style="color:#999;">No products available.</p>';
            return;
          }

          productsList.innerHTML = `<p><strong>Total Products:</strong> ${products.length}</p>`;
          products.slice(0, 10).forEach(product => {
            const div = document.createElement('div');
            div.style.cssText = 'border:1px solid #ffd6e0; padding:10px; margin:5px 0; border-radius:10px; display:flex; gap:15px; align-items:center;';
            div.innerHTML = `
              <img src="${product.image || 'https://via.placeholder.com/80'}" style="width:80px; height:80px; object-fit:cover; border-radius:10px;" onerror="this.src='https://via.placeholder.com/80'">
              <div style="flex:1;">
                <h4 style="margin:0;">${product.name}</h4>
                <p style="margin:5px 0; color:#666;">${product.category}</p>
                <p style="margin:0; color:#ff6b9d; font-weight:bold;">$${product.price.toFixed(2)}</p>
              </div>
            `;
            productsList.appendChild(div);
          });
          
          if (products.length > 10) {
            productsList.innerHTML += `<p style="text-align:center; margin-top:15px;">...and ${products.length - 10} more products</p>`;
          }
        } else {
          productsList.innerHTML = '<p style="color:#ff6b9d;">Failed to load products.</p>';
        }
      } catch (error) {
        console.error('Error loading products:', error);
        productsList.innerHTML = '<p style="color:#ff6b9d;">Error loading products.</p>';
      }
    }

    async function syncCJProducts() {
      const keyword = document.getElementById('sync-keyword').value.trim() || 'baby';
      const pageSize = parseInt(document.getElementById('sync-count').value) || 20;
      const statusDiv = document.getElementById('sync-status');
      
      statusDiv.innerHTML = '<p style="color:#ff6b9d;">Syncing products from CJ Dropshipping...</p>';
      
      try {
        const response = await fetch('/api/cj/sync', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ keyword, page_size: pageSize })
        });

        const result = await response.json();
        
        if (result.success) {
          statusDiv.innerHTML = `<p style="color:green;">✓ ${result.message}</p>`;
          await loadProducts();
        } else {
          statusDiv.innerHTML = `<p style="color:orange;">⚠ ${result.message}</p>`;
          if (result.hint) {
            statusDiv.innerHTML += `<p style="color:#666; font-size:0.9em;">${result.hint}</p>`;
          }
        }
      } catch (error) {
        console.error('Error syncing products:', error);
        statusDiv.innerHTML = '<p style="color:red;">✗ Failed to sync products. Check console for details.</p>';
      }
    }
  </script>
</body>
</html>